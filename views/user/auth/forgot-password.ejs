<div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center" style="background-color: #E5E5E5;">
  <div class="row shadow rounded overflow-hidden" style="max-width: 500px;">
    <div class="col bg-white p-5">
      <div class="text-center mb-3">
        <a href="/" class="text-decoration-none">
          <img src="https://res.cloudinary.com/daqfxkc3u/image/upload/v1749703192/laceduplogowhitebg_oundjw.png" alt="LacedUp Logo" style="height: 70px; cursor: pointer;">
        </a>
      </div>
      <h4 class="fw-bold text-center mb-3">Forgot Password</h4>
      <p class="text-center text-secondary">Enter your registered email to receive an OTP</p>

      <form id="forgot-form">
        <div class="mb-3">
          <input type="email" id="email" name="email" class="form-control" placeholder="Email address" required>
        </div>
        <button type="submit" class="btn btn-primary-custom w-100" id="send-otp-btn">
          <span class="btn-text">Send OTP</span>
          <span class="btn-loader d-none">
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            Sending OTP...
          </span>
        </button>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  // Prevent back button navigation
  (function() {
    if (window.history && window.history.pushState) {
      window.history.pushState('forward', null, window.location.href);
      window.addEventListener('popstate', function() {
        window.history.pushState('forward', null, window.location.href);
      });
    }
  })();

  const sendOtpBtn = document.getElementById('send-otp-btn');
  const btnText = sendOtpBtn.querySelector('.btn-text');
  const btnLoader = sendOtpBtn.querySelector('.btn-loader');

  // Function to show/hide loader
  function toggleLoader(show) {
    if (show) {
      btnText.classList.add('d-none');
      btnLoader.classList.remove('d-none');
      sendOtpBtn.disabled = true;
    } else {
      btnText.classList.remove('d-none');
      btnLoader.classList.add('d-none');
      sendOtpBtn.disabled = false;
    }
  }

  document.getElementById('forgot-form').addEventListener('submit', async function (e) {
    e.preventDefault();

    const email = document.getElementById('email').value.trim();

    // Show loader
    toggleLoader(true);

    try {
      const res = await fetch('/forgot-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      });

      const data = await res.json();

      if (res.ok && data.redirect) {
        Swal.fire({
          icon: 'success',
          title: 'OTP Sent!',
          text: 'Please check your email for the verification code.',
          showConfirmButton: false,
          timer: 2000
        }).then(() => {
          window.location.href = data.redirect;
        });
      } else {
        toggleLoader(false);
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: data.error || 'Could not send OTP.'
        });
      }
    } catch (err) {
      toggleLoader(false);
      console.error('Network error:', err);
      Swal.fire({
        icon: 'error',
        title: 'Oops!',
        text: 'Something went wrong.'
      });
    }
  });
</script>